<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Impact du tronc commun et de la ségrégation scolaire</title>
    
    <!-- React et ReactDOM -->
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    
    <!-- Recharts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/recharts/2.10.3/Recharts.js"></script>
    
    <!-- Babel pour JSX -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    
    <!-- Tailwind pour le style -->
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { LineChart, Line, XAxis, YAxis, Tooltip, Legend, ResponsiveContainer } = Recharts;
        
        const TrackingEffect = () => {
            const [segregationLevel, setSegregationLevel] = React.useState(30);
            
            const generateData = (segregation) => {
                const data = [];
                const segregationImpact = segregation / 100;
                
                for (let trackingYears = 4; trackingYears <= 12; trackingYears++) {
                    const trackingEffect = (trackingYears - 4) * 2;
                    
                    const highSESPerf = 540 - (segregationImpact * 10) + (trackingEffect * 0.5);
                    const midSESPerf = 500 + (trackingEffect * 1.0) - (segregationImpact * 15);
                    const lowSESPerf = 460 + (trackingEffect * 1.5) - (segregationImpact * 20);
                    
                    const dispersion = 40 + (segregationImpact * 40) - (trackingEffect * 1.5);
                    
                    data.push({
                        annees: trackingYears,
                        'Élèves favorisés': Math.round(highSESPerf),
                        'Élèves moyens': Math.round(midSESPerf),
                        'Élèves défavorisés': Math.round(lowSESPerf),
                        'Indice de dispersion': Math.round(Math.max(20, dispersion))
                    });
                }
                
                return {
                    performanceData: data
                };
            };

            const [data, setData] = React.useState(generateData(segregationLevel));

            React.useEffect(() => {
                setData(generateData(segregationLevel));
            }, [segregationLevel]);

            return (
                <div className="p-6 bg-white max-w-4xl mx-auto">
                    <h2 className="text-xl font-bold mb-4">Impact de la durée du tronc commun et de la ségrégation scolaire</h2>
                    
                    <div className="mb-6">
                        <label className="block text-sm font-medium mb-2">
                            Niveau de ségrégation entre écoles : {segregationLevel}%
                        </label>
                        <input
                            type="range"
                            min="0"
                            max="100"
                            value={segregationLevel}
                            onChange={(e) => setSegregationLevel(Number(e.target.value))}
                            className="w-full"
                        />
                        <p className="text-sm text-gray-600 mt-1">
                            0% = répartition homogène des élèves, 100% = forte concentration par niveau
                        </p>
                    </div>
                    
                    <div className="space-y-6">
                        <div className="h-64">
                            <h3 className="text-lg font-medium mb-2">Performances par groupe socio-économique</h3>
                            <ResponsiveContainer width="100%" height="100%">
                                <LineChart data={data.performanceData}>
                                    <XAxis 
                                        dataKey="annees" 
                                        label={{ value: 'Durée du tronc commun (années)', position: 'insideBottom', offset: -5 }}
                                    />
                                    <YAxis 
                                        label={{ value: 'Score PISA', angle: -90, position: 'insideLeft' }}
                                        domain={[400, 600]}
                                    />
                                    <Tooltip />
                                    <Legend />
                                    <Line 
                                        type="monotone" 
                                        dataKey="Élèves favorisés" 
                                        stroke="#2563eb" 
                                        strokeWidth={2}
                                    />
                                    <Line 
                                        type="monotone" 
                                        dataKey="Élèves moyens" 
                                        stroke="#059669" 
                                        strokeWidth={2}
                                    />
                                    <Line 
                                        type="monotone" 
                                        dataKey="Élèves défavorisés" 
                                        stroke="#dc2626" 
                                        strokeWidth={2}
                                    />
                                </LineChart>
                            </ResponsiveContainer>
                        </div>

                        <div className="h-64">
                            <h3 className="text-lg font-medium mb-2">Indice de dispersion des résultats</h3>
                            <ResponsiveContainer width="100%" height="100%">
                                <LineChart data={data.performanceData}>
                                    <XAxis 
                                        dataKey="annees" 
                                        label={{ value: 'Durée du tronc commun (années)', position: 'insideBottom', offset: -5 }}
                                    />
                                    <YAxis 
                                        label={{ value: 'Dispersion des résultats', angle: -90, position: 'insideLeft' }}
                                        domain={[0, 100]}
                                    />
                                    <Tooltip />
                                    <Line 
                                        type="monotone" 
                                        dataKey="Indice de dispersion" 
                                        stroke="#6b7280" 
                                        strokeWidth={2}
                                    />
                                </LineChart>
                            </ResponsiveContainer>
                        </div>
                    </div>
                    
                    <div className="mt-4 text-sm text-gray-600">
                        <p className="mb-2">Cette visualisation montre comment la durée du tronc commun et le niveau de 
                        ségrégation entre écoles affectent :</p>
                        <ul className="list-disc pl-5 space-y-1">
                            <li>Les performances des différents groupes socio-économiques</li>
                            <li>La dispersion globale des résultats (mesure d'équité)</li>
                        </ul>
                        <p className="mt-2">Le modèle suggère que :</p>
                        <ul className="list-disc pl-5 space-y-1">
                            <li>Un tronc commun plus long tend à réduire les écarts</li>
                            <li>Une forte ségrégation amplifie les inégalités</li>
                            <li>Les élèves défavorisés sont plus sensibles aux effets de composition</li>
                        </ul>
                    </div>
                </div>
            );
        };

        // Rendu de l'application
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<TrackingEffect />);
    </script>
</body>
</html>